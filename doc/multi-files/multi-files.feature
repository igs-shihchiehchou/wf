# language: zh-TW
Feature: multi-files
  作為 使用者
  我希望 可以同時讀取超過一個音效檔案
  以便 快速編輯多個音效檔案

  Background:
    Given 使用者已開啟音效編輯工具
    And 產生一個 音訊輸入 node

  # ============================================
  # Scenario 1: 上傳多個檔案
  # ============================================
  Scenario: 成功上傳多個音效檔案
    When 使用者選擇多個音效檔案（例如 3 個 WAV 檔案）
    Then 所有檔案成功載入
    And 每個檔案顯示在檔案列表中
    And 顯示檔案總數

  # ============================================
  # Scenario 2: 節點預覽區域顯示
  # ============================================
  Scenario: 節點上顯示多個預覽區域
    Given 使用者已上傳多個音效檔案
    When 展開預覽頁簽
    Then 節點上顯示多個預覽區域
    And 每個預覽區域顯示對應的檔案名稱
    And 每個預覽區域顯示音訊波形圖

  # ============================================
  # Scenario 3: 預覽頁簽預設狀態
  # ============================================
  Scenario: 單一檔案時預覽頁簽預設開啟
    Given 使用者已上傳 1 個音效檔案
    Then 預覽頁簽預設為開啟狀態
    And 直接顯示該檔案的預覽區域

  Scenario: 多個檔案時預覽頁簽預設關閉
    Given 使用者已上傳超過 1 個音效檔案
    Then 預覽頁簽預設為關閉狀態
    And 節點僅顯示檔案數量摘要
    When 點擊預覽頁簽按鈕
    Then 展開預覽區域顯示所有檔案

  # ============================================
  # Scenario 4: 檔案超過 5 個時分頁顯示
  # ============================================
  Scenario: 預覽區域分頁功能
    Given 使用者已上傳超過 5 個音效檔案（例如 8 個）
    And 展開預覽頁簽
    Then 預覽區域每頁最多顯示 5 個檔案
    And 顯示分頁資訊（如「第 1 頁，共 2 頁」）
    And 顯示「下一頁」按鈕
    When 點擊「下一頁」按鈕
    Then 顯示第 6 至第 8 個檔案的預覽
    And 顯示「上一頁」按鈕

  # ============================================
  # Scenario 5: 下載處理後的多個檔案
  # ============================================
  Scenario: 下載多檔案為壓縮檔
    Given 使用者已上傳多個音效檔案
    And 已設計完成工作流
    When 按下下載按鈕
    Then 所有處理後的檔案被打包成一個壓縮檔（ZIP 格式）
    And 自動下載該壓縮檔

  # ============================================
  # Scenario 6: 部分檔案處理失敗
  # ============================================
  Scenario: 部分檔案格式不支援
    Given 使用者選擇的檔案中包含不支援的格式
    When 上傳檔案
    Then 顯示錯誤訊息指出哪些檔案無法處理
    And 支援的檔案仍可正常載入

  # ============================================
  # Scenario 7: 批量音量調整
  # ============================================
  Scenario: 多檔案批量調整音量
    Given 使用者已上傳多個音效檔案
    And 已連結音量調整節點
    When 調整音量參數
    Then 所有檔案套用相同的音量調整
    And 音量調整節點顯示多檔案預覽
    And 每個預覽區域顯示調整後的波形

  # ============================================
  # Scenario 8: 批量裁切
  # ============================================
  Scenario: 多檔案批量裁切
    Given 使用者已上傳多個音效檔案
    And 已連結裁切節點
    When 設定裁切的起始和結束時間
    Then 所有檔案套用相同的裁切設定
    And 裁切節點顯示多檔案預覽
    And 每個預覽區域顯示裁切後的波形

  # ============================================
  # Scenario 9: 批量淡入
  # ============================================
  Scenario: 多檔案批量淡入
    Given 使用者已上傳多個音效檔案
    And 已連結淡入節點
    When 設定淡入時間長度
    Then 所有檔案套用相同的淡入效果
    And 淡入節點顯示多檔案預覽
    And 每個預覽區域顯示淡入後的波形

  # ============================================
  # Scenario 10: 批量淡出
  # ============================================
  Scenario: 多檔案批量淡出
    Given 使用者已上傳多個音效檔案
    And 已連結淡出節點
    When 設定淡出時間長度
    Then 所有檔案套用相同的淡出效果
    And 淡出節點顯示多檔案預覽
    And 每個預覽區域顯示淡出後的波形

  # ============================================
  # Scenario 11: 批量速度調整
  # ============================================
  Scenario: 多檔案批量調整速度
    Given 使用者已上傳多個音效檔案
    And 已連結速度調整節點
    When 調整播放速度參數
    Then 所有檔案套用相同的速度調整
    And 速度調整節點顯示多檔案預覽
    And 每個預覽區域顯示調整後的波形

  # ============================================
  # Scenario 12: 批量音高調整
  # ============================================
  Scenario: 多檔案批量調整音高
    Given 使用者已上傳多個音效檔案
    And 已連結音高調整節點
    When 調整音高參數（半音數）
    Then 所有檔案套用相同的音高調整
    And 音高調整節點顯示多檔案預覽
    And 每個預覽區域顯示調整後的波形

  # ============================================
  # Scenario 13: 批量智慧音高調整
  # ============================================
  Scenario: 多檔案批量智慧音高調整
    Given 使用者已上傳多個音效檔案
    And 已連結智慧音高調整節點
    When 設定目標音高
    Then 系統自動偵測每個檔案的原始音高
    And 所有檔案調整至相同的目標音高
    And 智慧音高調整節點顯示多檔案預覽
    And 每個預覽區域顯示調整後的波形

  # ============================================
  # Scenario 14: 處理節點多檔案預覽
  # ============================================
  Scenario: 處理節點顯示多檔案預覽
    Given 使用者已上傳多個音效檔案
    And 已連結任意處理節點（如音量調整、裁切等）
    When 處理節點接收多個檔案的輸入
    Then 處理節點顯示多檔案預覽區域
    And 預覽區域顯示檔案數量摘要（如「3 個處理結果」）
    And 每個預覽區域顯示對應的檔案名稱
    And 每個預覽區域顯示處理後的音訊波形圖
    And 每個預覽區域可獨立播放與下載
    And 預覽頁簽預設為關閉狀態

  Scenario: 處理節點多檔案預覽分頁
    Given 使用者已上傳超過 5 個音效檔案
    And 已連結任意處理節點
    When 展開處理節點的預覽頁簽
    Then 預覽區域每頁最多顯示 5 個檔案
    And 顯示分頁資訊（如「第 1 頁，共 2 頁」）
    And 可透過分頁按鈕切換檢視不同檔案

  # ============================================
  # Scenario 15: 處理節點多檔案下載
  # ============================================
  Scenario: 處理節點下載多檔案為壓縮檔
    Given 使用者已上傳多個音效檔案
    And 已連結任意處理節點（如音量調整、裁切等）
    And 處理節點已顯示多檔案預覽
    When 按下處理節點的「下載全部」按鈕
    Then 所有處理後的檔案被打包成一個壓縮檔（ZIP 格式）
    And 自動下載該壓縮檔
    And 壓縮檔內的檔案保留原始檔名

  Scenario: 處理節點下載單一檔案
    Given 使用者已上傳多個音效檔案
    And 已連結任意處理節點
    And 處理節點已顯示多檔案預覽
    When 按下單一檔案的「下載」按鈕
    Then 僅下載該檔案（WAV 格式）
    And 檔案名稱保留原始檔名

  # ============================================
  # Scenario 16: 批量調性整合節點
  # ============================================
  Scenario: 調性整合節點分析多個檔案
    Given 使用者已上傳多個音效檔案
    And 已連結調性整合節點
    When 節點接收多個檔案的輸入
    Then 系統自動分析每個檔案的音高（僅分析音高以加速）
    And 第一個預覽區域顯示所有檔案的音高分析結果
    And 每個檔案顯示檔案名稱與偵測到的調性
    And 支援多檔案分頁顯示

  Scenario: 調性整合節點選擇目標調性
    Given 使用者已上傳多個音效檔案
    And 調性整合節點已完成分析
    When 使用者從下拉選單選擇目標調性（如 C, D, E 等）
    Then 系統計算每個檔案需要移調的半音數
    And 顯示每個檔案的移調方案（原調性 → 目標調性）

  Scenario: 調性整合節點套用統一調性
    Given 使用者已選擇目標調性
    When 按下「套用」按鈕
    Then 所有檔案自動移調至相同的目標調性
    And 第二個預覽區域顯示處理後的多檔案預覽（與其他處理節點相同）
    And 每個預覽區域顯示處理後的波形
    And 每個預覽區域可獨立播放與下載

  Scenario: 調性整合節點下載
    Given 調性整合節點已處理多個檔案
    When 按下「下載全部」按鈕
    Then 所有調性統一後的檔案被打包成 ZIP 壓縮檔
    And 自動下載該壓縮檔

